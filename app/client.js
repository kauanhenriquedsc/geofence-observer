const axios = require('axios');

let pos = { lat: -23.501175, lng: -46.838711 };

function randomizePos() {
    pos.lat += (Math.random() - 0.5) * 0.0005;
    pos.lng += (Math.random() - 0.5) * 0.0005;
}
const routePoints = [
    [-46.859283,-23.499716],[-46.859498,-23.499606],[-46.859428,-23.499521],[-46.859307,-23.499425],
    [-46.858749,-23.499112],[-46.858308,-23.498902],[-46.858232,-23.498853],[-46.857281,-23.498377],
    [-46.857059,-23.49829],[-46.856872,-23.498234],[-46.856707,-23.498218],[-46.856534,-23.498212],
    [-46.856386,-23.498217],[-46.8562,-23.498235],[-46.854229,-23.498555],[-46.853032,-23.498727],
    [-46.852578,-23.498811],[-46.852355,-23.498835],[-46.852159,-23.498873],[-46.851668,-23.498944],
    [-46.851269,-23.498993],[-46.85103,-23.499001],[-46.850627,-23.498978],[-46.850493,-23.498962],
    [-46.850419,-23.498928],[-46.85033,-23.498903],[-46.849922,-23.498811],[-46.847446,-23.498505],
    [-46.847371,-23.498499],[-46.847021,-23.498498],[-46.846892,-23.498531],[-46.846766,-23.498562],
    [-46.846592,-23.498628],[-46.846299,-23.49878],[-46.84615,-23.498872],[-46.845643,-23.499081],
    [-46.845447,-23.499185],[-46.845126,-23.499395],[-46.844839,-23.499608],[-46.844346,-23.499905],
    [-46.844169,-23.499994],[-46.844011,-23.500062],[-46.843799,-23.50013],[-46.842875,-23.500362],
    [-46.842042,-23.500557],[-46.841524,-23.500669],[-46.84105,-23.500793],[-46.840089,-23.501012],
    [-46.838362,-23.501437],[-46.838178,-23.501473],[-46.837819,-23.501566],[-46.837363,-23.501672],
    [-46.837288,-23.501698],[-46.837047,-23.501742],[-46.836955,-23.501771],[-46.835906,-23.502006],
    [-46.834825,-23.502289],[-46.834525,-23.502347],[-46.833362,-23.502636],[-46.832681,-23.502818],
    [-46.832321,-23.502934],[-46.832173,-23.502973],[-46.831999,-23.503007],[-46.831683,-23.502983],
    [-46.831489,-23.502986],[-46.829101,-23.503242],[-46.827771,-23.503397],[-46.826948,-23.503473],
    [-46.823637,-23.503827],[-46.823608,-23.503957],[-46.823555,-23.504339],[-46.823508,-23.504584]
];

function clientRoute(intervalMs = 1000) {
    let i = 0;
    async function nextStep() {
        if (i >= routePoints.length) {
            console.log("[RASTREADOR] Rota finalizada.");
            return;
        }
        pos = { lat: routePoints[i][1], lng: routePoints[i][0] }; // Atenção: ordem [lng, lat]
        try {
            const resp = await axios.post('http://localhost:3001/check-geofence', pos);
            await axios.post('http://localhost:3001/client-point', pos);
            console.log(`[RASTREADOR] Enviando lat:${pos.lat.toFixed(6)}, lng:${pos.lng.toFixed(6)} | Dentro da geocerca?`, resp.data.inside);
        } catch (err) {
            console.error('Erro ao enviar posição:', err.message);
        }
        i++;
        setTimeout(nextStep, intervalMs);
    }
    nextStep();
}

// async function sendPosition() {
//     try {
//         randomizePos();
//         const resp = await axios.post('http://localhost:3001/check-geofence', pos);
//         await axios.post('http://localhost:3001/client-point', pos);
//         console.log(`[CLIENT] Enviando lat:${pos.lat.toFixed(6)}, lng:${pos.lng.toFixed(6)} | Dentro da geocerca?`, resp.data.inside);
//     } catch (err) {
//         console.error('Erro ao enviar posição:', err.message);
//     }
// }


clientRoute(250); 
